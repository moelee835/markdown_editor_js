<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Markdown Editor & Viewer</title>
<link rel="icon" href=".\static\img\markdown.PNG" type="image/x-icon" />
<style>
  /* Í∏∞Î≥∏ Î†àÏù¥ÏïÑÏõÉ */
  html, body {
    height: 100%;
    margin: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
  }
  #toolbar {
    background: #2d2d2d;
    color: white;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  #toolbar > * {
    cursor: pointer;
  }
  #container {
    flex: 1;
    display: flex;
    height: calc(100% - 40px);
    overflow: hidden;
  }
  #editor, #preview {
    height: 100%;
    box-sizing: border-box;
    padding: 12px;
    border: 1px solid #ccc;
    overflow: auto;
  }
  #editor {
    width: 50%;
    font-family: Consolas, Monaco, monospace;
    font-size: 16px;
    resize: none;
    outline: none;
  }
  #preview {
    width: 50%;
    background: white;
  }
  #preview.fullscreen {
    position: fixed;
    top: 91px; left: 0; right: 0; bottom: 0;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 9999;
    border: none;
    padding: 20px;
    overflow-y: auto;
    background: white;
  }
  button {
    background: #5a9bd4;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 3px;
    font-size: 14px;
  }
  button:active {
    background: #427ab3;
  }
  
  .backBtn {
      opacity: 0.5;
      display: none;
      height: 50px;
      width: 80px;
      position: absolute;
      z-index : 9999;
      top:90%;
      right:5%;
      background: #FF0000;
  }
  input[type=file] {
    display: none;
  }
  label[for=fileInput] {
    background: #5a9bd4;
    color: white;
    padding: 6px 12px;
    border-radius: 3px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
  }
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
  }
</style>
</head>
<body>

<div id="toolbar">
  <label for="fileInput" title=".md ÌååÏùº Î∂àÎü¨Ïò§Í∏∞">üìÇ Î∂àÎü¨Ïò§Í∏∞</label>
  <input type="file" id="fileInput" accept=".md,text/markdown,text/plain" />
  <button id="saveBtn" title="ÌòÑÏû¨ ÎßàÌÅ¨Îã§Ïö¥ Ï†ÄÏû•ÌïòÍ∏∞">üíæ Ï†ÄÏû•</button>
  <button id="togglePreviewBtn" title="ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ÑÏ≤¥ÌôîÎ©¥ Ï†ÑÌôò">üîç Ï†ÑÏ≤¥ÌôîÎ©¥</button>
  <!-- <button id="saveAsPdfBtn" title="pdfÎ°ú Îã§Ïö¥Î°úÎìú">üìïPDFÎ°ú Ï†ÄÏû•</button> -->
</div>

<div id="container">
  <textarea id="editor" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Markdown ÌÖçÏä§Ìä∏Î•º Ïó¨Í∏∞Ïóê ÏûëÏÑ±ÌïòÏÑ∏Ïöî..."></textarea>
  <div id="preview" aria-live="polite" aria-label="Markdown ÎØ∏Î¶¨Î≥¥Í∏∞"></div>
</div>

<!-- marked.min.js - CDN -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://raw.githubusercontent.com/eKoopmans/html2pdf.js/master/dist/html2pdf.bundle.js"></script>
<script>
(() => {
  const editor = document.getElementById("editor");
  const preview = document.getElementdById("preview");
  const fileInput = document.getElementById("fileInput");
  const saveBtn = document.getElementById("saveBtn");
  const togglePreviewBtn = document.getElementById("togglePreviewBtn");

  const isFileSystemAccessAPISupported = 'showSaveFilePicker' in window;
  let filename = `markdown-${new Date().toISOString().slice(0,10)}.md`;

  //const saveAsPdfBtn = document.getElementById("saveAsPdfBtn");
  
  // Í∏∞Î≥∏ ÎßàÌÅ¨Îã§Ïö¥ ÏÉòÌîå ÌÖçÏä§Ìä∏
  const defaultMd = `# Markdown Editor & Viewer

- ÏôºÏ™ΩÏóê ÎßàÌÅ¨Îã§Ïö¥ ÏûÖÎ†•
- Ïò§Î•∏Ï™ΩÏóê Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞
- ÌååÏùº Î∂àÎü¨Ïò§Í∏∞ Î∞è Ï†ÄÏû• Í∞ÄÎä•
- ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä

---

## ÏÇ¨Ïö©Î≤ï

1. MarkdownÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.
2. üìÇ Î∂àÎü¨Ïò§Í∏∞ Î≤ÑÌäºÏúºÎ°ú .md ÌååÏùºÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏûàÏäµÎãàÎã§.
3. üíæ Ï†ÄÏû• Î≤ÑÌäºÏúºÎ°ú ÏûëÏÑ±Ìïú ÎÇ¥Ïö©ÏùÑ .md ÌååÏùºÎ°ú Ï†ÄÏû•Ìï† Ïàò ÏûàÏäµÎãàÎã§.
4. üîç Ï†ÑÏ≤¥ÌôîÎ©¥ Î≤ÑÌäºÏúºÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞Î•º Î∏åÎùºÏö∞Ï†Ä Ï†ÑÏ≤¥ ÌôîÎ©¥ÏúºÎ°ú Î≥º Ïàò ÏûàÏäµÎãàÎã§.

---

> ÌöåÏùò Í∏∞Î°ù ÎòêÎäî Î©îÎ™® ÏûëÏÑ±Ïãú ÎçîÏö± Ìé∏Î¶¨ÌïòÍ≤å ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî!`;

  // ÎßàÌÅ¨Îã§Ïö¥ -> HTML Ïã§ÏãúÍ∞Ñ Î≥ÄÌôò  
  function refreshPreview() {
    const mdText = editor.value;
    try {
      const html = marked.parse(mdText, { breaks: true, gfm: true });
      preview.innerHTML = html;
    } catch(e) {
      preview.textContent = "Markdown Î†åÎçîÎßÅ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.";
      console.error(e);
    }
  }

  // Î≥ÄÍ≤Ω Í∞êÏßÄÏãú preview Í∞±Ïã† (ÎîîÎ∞îÏö¥Ïã±)
  let debounceTimer = null;
  editor.addEventListener("input", () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(refreshPreview, 150);
  });

  // ÌååÏùº Î∂àÎü¨Ïò§Í∏∞ (.md Îßå ÌóàÏö©)
  fileInput.addEventListener("change", e => {
    const file = e.target.files[0];
    alert(file.name);
    if (!file) return;
    if (!file.name.endsWith(".md")) {
      alert(".md ÌôïÏû•Ïûê ÌååÏùºÎßå ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
      fileInput.value = "";
      return;
    }
    const reader = new FileReader();
    reader.onload = function(evt) {
      editor.value = evt.target.result;
      refreshPreview();
      fileInput.value = "";
    };
    reader.readAsText(file);
  });

  async function saveMarkdownWithPicker(content, suggestedName) {
  if (!isFileSystemAccessAPISupported) {
    alert("Ïù¥ Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî Í≥†Í∏â Ï†ÄÏû• Í∏∞Îä•Ïù¥ ÏßÄÏõêÎêòÏßÄ ÏïäÏïÑ Í∏∞Î≥∏ Îã§Ïö¥Î°úÎìúÎ•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.");
    fallbackDownload(content, suggestedName);
    return;
  }

  try {
    const options = {
      types: [{
        description: 'Markdown ÌååÏùº',
        accept: { 'text/markdown': ['.md'] },
      }],
      suggestedName,
    };
    const handle = await window.showSaveFilePicker(options);
    const writable = await handle.createWritable();
    await writable.write(content);
    await writable.close();
    alert("ÌååÏùºÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.");
  } catch (e) {
    if (e.name !== 'AbortError') {
      alert("ÌååÏùº Ï†ÄÏû• Ï§ë Ïò§Î•ò Î∞úÏÉù: " + e.message);
    }
    // Ï†ÄÏû• Ï∑®ÏÜåÏãú Î≥ÑÎèÑ Ï≤òÎ¶¨ ÏóÜÏùå
  }
}

// Ìè¥Î∞± Îã§Ïö¥Î°úÎìú Ìï®Ïàò (Í∏∞Ï°¥ ÏΩîÎìú)
function fallbackDownload(content, filename) {
  const blob = new Blob([content], { type: "text/markdown;charset=utf-8" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

  // ÏûëÏÑ±Ï§ë ÎÇ¥Ïö© Ï†ÄÏû•ÌïòÍ∏∞ (.md ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìú)
  saveBtn.addEventListener("click", async () => {
  const text = editor.value;
  await saveMarkdownWithPicker(text, filename);
});
    
  togglePreview = () => {
    if (preview.classList.contains("fullscreen")) {
      preview.classList.remove("fullscreen");
      // container ÎÇ¥Î∂Ä ÎπÑÏú® ÏõêÎ≥µ
      editor.style.display = "block";
      editor.style.width = "50%";
      preview.style.width = "50%";
      togglePreviewBtn.textContent = "üîç Ï†ÑÏ≤¥ÌôîÎ©¥";
      backBtn.style.display = "none";
    } else {
      preview.classList.add("fullscreen");
      // ÏóêÎîîÌÑ∞ Í∞êÏ∂îÍ∏∞
      editor.style.display = "none";
      preview.style.width = "100%";
      togglePreviewBtn.textContent = "‚ùåÎèåÏïÑÍ∞ÄÍ∏∞"
    }
  }
  // ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ÑÏ≤¥ÌôîÎ©¥ ÌÜ†Í∏Ä
  togglePreviewBtn.addEventListener("click", togglePreview);
  // Ï¥àÍ∏∞Í∞í ÏÖãÌåÖ & Î†åÎçîÎßÅ
  editor.value = defaultMd;
  refreshPreview();
  

//  savePdf = () => {
//    html2pdf().from(preview).set({
//      margin : 10,
//      filename: window.prompt() + ".pdf",
//      html2canvas: {scale : 1},
//      jsPDF: {orientation: 'portrait', unit: 'mm', format: 'a4', compressPDF: true}
//      }
//    ).save();
//  }
  
  //saveAsPdfBtn.addEventListener("click", savePdf);
})();
</script>

</body>
</html>
